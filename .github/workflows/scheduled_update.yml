Run set -e
  set -e
  echo "🔍 Checking for changes in playlist.m3u8..."
  
  # Show current status (for debugging)
  git status
  git --no-pager diff -- playlist.m3u8 || true
  
  # Skip if no changes
  if git diff --quiet -- playlist.m3u8; then
    echo "✅ No changes detected in playlist.m3u8 — skipping commit."
    exit 0
  fi
  
  echo "🎯 Changes detected — committing and pushing update..."
  
  # Configure Git identity
  git config user.name "github-actions[bot]"
  git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
  
  # ✅ Stage the file BEFORE pulling to avoid the unstaged changes error
  git add playlist.m3u8
  
  # Pull latest changes safely; abort rebase on conflict
  git pull --rebase || git rebase --abort
  
  # Commit and push
  git commit -m "🤖 Playlist update: new HLS links [skip ci]"
  git push
  
  echo "🚀 Playlist successfully committed and pushed!"
  shell: /usr/bin/bash -e {0}
  env:
    pythonLocation: /opt/hostedtoolcache/Python/3.14.0/x64
    PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.14.0/x64/lib/pkgconfig
    Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.14.0/x64
    Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.14.0/x64
    Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.14.0/x64
    LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.14.0/x64/lib
🔍 Checking for changes in playlist.m3u8...
On branch main
Your branch is up to date with 'origin/main'.

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
	modified:   playlist.m3u8

no changes added to commit (use "git add" and/or "git commit -a")
diff --git a/playlist.m3u8 b/playlist.m3u8
index e69de29..44c15f6 100644
--- a/playlist.m3u8
+++ b/playlist.m3u8
@@ -0,0 +1,3 @@
+#EXTM3U
+# Generated on 2025-10-31 04:22:41 UTC
+#EXT-X-VERSION:3
🎯 Changes detected — committing and pushing update...
error: cannot pull with rebase: Your index contains uncommitted changes.
error: Please commit or stash them.
fatal: no rebase in progress
Error: Process completed with exit code 128.
